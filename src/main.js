// arquivo database local
// import database from "./db.json" assert { type: "json" };

const database = {
  "data": "27/02/2023",
  "lista": [
    {
      "valor": 1.99,
      "produto": "Laranja Pera",
      "loja": "CARNAÚBA",
      "id": 2
    },
    {
      "valor": 3.29,
      "produto": "Abacate",
      "loja": "CARNAÚBA",
      "id": 3
    },
    {
      "valor": 3.99,
      "produto": "Batata Inglesa",
      "loja": "CARNAÚBA",
      "id": 4
    },
    {
      "valor": 5.99,
      "produto": "Cebola Roxa",
      "loja": "CARNAÚBA",
      "id": 5
    },
    {
      "valor": 0.99,
      "produto": "Côco Verde",
      "loja": "CARNAÚBA",
      "id": 6
    },
    {
      "valor": 1.99,
      "produto": "Limão Taiti",
      "loja": "CARNAÚBA",
      "id": 7
    },
    {
      "valor": 4.99,
      "produto": "Repolho Verde",
      "loja": "CARNAÚBA",
      "id": 8
    },
    {
      "valor": 1.39,
      "produto": "Melancia Baby",
      "loja": "CARNAÚBA",
      "id": 9
    },
    {
      "valor": 2.59,
      "produto": "Chuchu",
      "loja": "CARNAÚBA",
      "id": 10
    },
    {
      "valor": 3.49,
      "produto": "Goiaba",
      "loja": "CARNAÚBA",
      "id": 11
    },
    {
      "valor": 6.99,
      "produto": "Uva Vitótia 500g",
      "loja": "CARNAÚBA",
      "id": 12
    },
    {
      "valor": 1.98,
      "produto": "Laranja Pera",
      "loja": "COMETA",
      "id": 13
    },
    {
      "valor": 4.28,
      "produto": "Batata Inglesa",
      "loja": "COMETA",
      "id": 14
    },
    {
      "valor": 4.48,
      "produto": "Banana Prata",
      "loja": "COMETA",
      "id": 15
    },
    {
      "valor": 2.98,
      "produto": "Melão Japonês",
      "loja": "COMETA",
      "id": 16
    },
    {
      "valor": 17.8,
      "produto": "Alho",
      "loja": "COMETA",
      "id": 17
    },
    {
      "valor": 1.48,
      "produto": "Melancia Baby",
      "loja": "COMETA",
      "id": 18
    },
    {
      "valor": 3.28,
      "produto": "Abacate",
      "loja": "COMETA",
      "id": 19
    },
    {
      "valor": 4.98,
      "produto": "Repolho Verde",
      "loja": "COMETA",
      "id": 20
    },
    {
      "valor": 1.98,
      "produto": "Pepino",
      "loja": "COMETA",
      "id": 21
    },
    {
      "valor": 8.98,
      "produto": "Uva Thompson 500g",
      "loja": "COMETA",
      "id": 22
    },
    {
      "valor": 8.98,
      "produto": "Uva Vitótia 500g",
      "loja": "COMETA",
      "id": 23
    },
    {
      "valor": 3.99,
      "produto": "Batata Inglesa",
      "loja": "FRANGOLÂNDIA",
      "id": 24
    },
    {
      "valor": 3.99,
      "produto": "Cebola",
      "loja": "FRANGOLÂNDIA",
      "id": 25
    },
    {
      "valor": 2.89,
      "produto": "Batata Doce",
      "loja": "FRANGOLÂNDIA",
      "id": 26
    },
    {
      "valor": 2.89,
      "produto": "Abacate",
      "loja": "FRANGOLÂNDIA",
      "id": 27
    },
    {
      "valor": 3.98,
      "produto": "Banana Prata",
      "loja": "FRANGOLÂNDIA",
      "id": 28
    },
    {
      "valor": 3.98,
      "produto": "Goiaba",
      "loja": "FRANGOLÂNDIA",
      "id": 29
    },
    {
      "valor": 1.79,
      "produto": "Abóbora Leite",
      "loja": "FRANGOLÂNDIA",
      "id": 30
    },
    {
      "valor": 1.79,
      "produto": "Abóbora Jacaré",
      "loja": "FRANGOLÂNDIA",
      "id": 31
    },
    {
      "valor": 2.49,
      "produto": "Pepino",
      "loja": "FRANGOLÂNDIA",
      "id": 32
    },
    {
      "valor": 2.49,
      "produto": "Chuchu",
      "loja": "FRANGOLÂNDIA",
      "id": 33
    },
    {
      "valor": 1.99,
      "produto": "Laranja Pera",
      "loja": "FRANGOLÂNDIA",
      "id": 34
    },
    {
      "valor": 5.49,
      "produto": "Cenoura",
      "loja": "FRANGOLÂNDIA",
      "id": 35
    },
    {
      "valor": 4.49,
      "produto": "Beterraba",
      "loja": "FRANGOLÂNDIA",
      "id": 36
    },
    {
      "valor": 6.39,
      "produto": "Pimentão Verde",
      "loja": "FRANGOLÂNDIA",
      "id": 37
    },
    {
      "valor": 0.69,
      "produto": "Milho Verde",
      "loja": "FRANGOLÂNDIA",
      "id": 38
    },
    {
      "valor": 6.99,
      "produto": "Maracujá",
      "loja": "FRANGOLÂNDIA",
      "id": 39
    },
    {
      "valor": 4.98,
      "produto": "Repolho Verde",
      "loja": "FRANGOLÂNDIA",
      "id": 40
    },
    {
      "valor": 3.39,
      "produto": "Mamão Formosa",
      "loja": "FRANGOLÂNDIA",
      "id": 41
    },
    {
      "valor": 9.99,
      "produto": "Maçã Nacional",
      "loja": "FRANGOLÂNDIA",
      "id": 42
    },
    {
      "valor": 2.49,
      "produto": "Limão Taiti",
      "loja": "FRANGOLÂNDIA",
      "id": 43
    },
    {
      "valor": 0.99,
      "produto": "Côco Verde",
      "loja": "FRANGOLÂNDIA",
      "id": 44
    },
    {
      "valor": 15.9,
      "produto": "Alho",
      "loja": "FRANGOLÂNDIA",
      "id": 45
    },
    {
      "valor": 13.98,
      "produto": "Ovo Gde Branco c/20",
      "loja": "FRANGOLÂNDIA",
      "id": 46
    },
    {
      "valor": 4.69,
      "produto": "Cebola",
      "loja": "GUARÁ",
      "id": 47
    },
    {
      "valor": 5.49,
      "produto": "Tomate Comum",
      "loja": "GUARÁ",
      "id": 48
    },
    {
      "valor": 4.99,
      "produto": "Pimentão Verde",
      "loja": "GUARÁ",
      "id": 49
    },
    {
      "valor": 3.99,
      "produto": "Beterraba",
      "loja": "GUARÁ",
      "id": 50
    },
    {
      "valor": 3.49,
      "produto": "Mamão Formosa",
      "loja": "GUARÁ",
      "id": 51
    },
    {
      "valor": 0.99,
      "produto": "Côco Verde",
      "loja": "GUARÁ",
      "id": 52
    },
    {
      "valor": 3.69,
      "produto": "Abacate",
      "loja": "GUARÁ",
      "id": 53
    },
    {
      "valor": 2.29,
      "produto": "Limão Taiti",
      "loja": "GUARÁ",
      "id": 54
    },
    {
      "valor": 2.59,
      "produto": "Laranja Pera",
      "loja": "GUARÁ",
      "id": 55
    },
    {
      "valor": 3.99,
      "produto": "Batata Inglesa",
      "loja": "GUARÁ",
      "id": 56
    },
    {
      "valor": 3.87,
      "produto": "Banana Prata",
      "loja": "IN NATURA",
      "id": 57
    },
    {
      "valor": 6.99,
      "produto": "Tomate Comum",
      "loja": "IN NATURA",
      "id": 58
    },
    {
      "valor": 3.37,
      "produto": "Mamão Formosa",
      "loja": "IN NATURA",
      "id": 59
    },
    {
      "valor": 5.99,
      "produto": "Pimentão Verde",
      "loja": "IN NATURA",
      "id": 60
    },
    {
      "valor": 6.99,
      "produto": "Uva Vitótia 500g",
      "loja": "IN NATURA",
      "id": 61
    },
    {
      "valor": 3.59,
      "produto": "Acerola 500g",
      "loja": "IN NATURA",
      "id": 62
    },
    {
      "valor": 2.48,
      "produto": "Limão Taiti",
      "loja": "IN NATURA",
      "id": 63
    },
    {
      "valor": 2.85,
      "produto": "Batata Doce",
      "loja": "IN NATURA",
      "id": 64
    },
    {
      "valor": 1.98,
      "produto": "Mamão Formosa",
      "loja": "MEGA ATACADISTA",
      "id": 65
    },
    {
      "valor": 1.98,
      "produto": "Laranja Pera",
      "loja": "MEGA ATACADISTA",
      "id": 66
    },
    {
      "valor": 2.99,
      "produto": "Batata Inglesa",
      "loja": "MEGA ATACADISTA",
      "id": 67
    },
    {
      "valor": 3.99,
      "produto": "Beterraba",
      "loja": "MEGA ATACADISTA",
      "id": 68
    },
    {
      "valor": 3.99,
      "produto": "Repolho Verde",
      "loja": "MEGA ATACADISTA",
      "id": 69
    },
    {
      "valor": 2.79,
      "produto": "Batata Doce",
      "loja": "MEGA ATACADISTA",
      "id": 70
    },
    {
      "valor": 1.69,
      "produto": "Abóbora Leite",
      "loja": "MEGA ATACADISTA",
      "id": 71
    },
    {
      "valor": 1.69,
      "produto": "Abóbora Jacaré",
      "loja": "MEGA ATACADISTA",
      "id": 72
    },
    {
      "valor": 3.49,
      "produto": "Banana Prata",
      "loja": "MEGA ATACADISTA",
      "id": 73
    },
    {
      "valor": 2.49,
      "produto": "Abacate",
      "loja": "MEGA ATACADISTA",
      "id": 74
    },
    {
      "valor": 2.49,
      "produto": "Limão Taiti",
      "loja": "MEGA ATACADISTA",
      "id": 75
    },
    {
      "valor": 2.49,
      "produto": "Pepino",
      "loja": "MEGA ATACADISTA",
      "id": 76
    },
    {
      "valor": 2.49,
      "produto": "Chuchu",
      "loja": "MEGA ATACADISTA",
      "id": 77
    },
    {
      "valor": 3.99,
      "produto": "Cebola",
      "loja": "MEGA ATACADISTA",
      "id": 78
    },
    {
      "valor": 6.39,
      "produto": "Pimentão Verde",
      "loja": "MEGA ATACADISTA",
      "id": 79
    },
    {
      "valor": 9.99,
      "produto": "Maçã Nacional",
      "loja": "MEGA ATACADISTA",
      "id": 80
    },
    {
      "valor": 3.49,
      "produto": "Goiaba",
      "loja": "MEGA ATACADISTA",
      "id": 81
    },
    {
      "valor": 6.99,
      "produto": "Maracujá",
      "loja": "MEGA ATACADISTA",
      "id": 82
    },
    {
      "valor": 1.98,
      "produto": "Abobrinha",
      "loja": "MEGA ATACADISTA",
      "id": 83
    },
    {
      "valor": 0.69,
      "produto": "Milho Verde",
      "loja": "MEGA ATACADISTA",
      "id": 84
    },
    {
      "valor": 14.9,
      "produto": "Alho",
      "loja": "MEGA ATACADISTA",
      "id": 85
    },
    {
      "valor": 0.99,
      "produto": "Côco Verde",
      "loja": "MEGA ATACADISTA",
      "id": 86
    },
    {
      "valor": 13.89,
      "produto": "Ovo Gde Branco c/20",
      "loja": "MEGA ATACADISTA",
      "id": 87
    },
    {
      "valor": 14.5,
      "produto": "Alho",
      "loja": "PINHEIRO",
      "id": 88
    },
    {
      "valor": 3.99,
      "produto": "Batata Inglesa",
      "loja": "PINHEIRO",
      "id": 89
    },
    {
      "valor": 3.88,
      "produto": "Beterraba",
      "loja": "PINHEIRO",
      "id": 90
    },
    {
      "valor": 4.28,
      "produto": "Cebola",
      "loja": "PINHEIRO",
      "id": 91
    },
    {
      "valor": 4.18,
      "produto": "Tomate Comum",
      "loja": "PINHEIRO",
      "id": 92
    },
    {
      "valor": 1.78,
      "produto": "Limão Taiti",
      "loja": "PINHEIRO",
      "id": 93
    },
    {
      "valor": 1.99,
      "produto": "Laranja Pera",
      "loja": "PINHEIRO",
      "id": 94
    },
    {
      "valor": 9.58,
      "produto": "Pera D'anjou",
      "loja": "PINHEIRO",
      "id": 95
    },
    {
      "valor": 8.28,
      "produto": "Maçã Nacional",
      "loja": "PINHEIRO",
      "id": 96
    },
    {
      "valor": 2.98,
      "produto": "Abacate",
      "loja": "PINHEIRO",
      "id": 97
    },
    {
      "valor": 5.18,
      "produto": "Mamão Havaí",
      "loja": "PINHEIRO",
      "id": 98
    },
    {
      "valor": 2.99,
      "produto": "Abacate",
      "loja": "SANTA EDWIRGES",
      "id": 99
    },
    {
      "valor": 2.79,
      "produto": "Acerola 500g",
      "loja": "SANTA EDWIRGES",
      "id": 100
    },
    {
      "valor": 3.99,
      "produto": "Batata Inglesa",
      "loja": "SANTA EDWIRGES",
      "id": 101
    },
    {
      "valor": 9.49,
      "produto": "Maçã Nacional",
      "loja": "SANTA EDWIRGES",
      "id": 102
    },
    {
      "valor": 2.29,
      "produto": "Laranja Pera",
      "loja": "SANTA EDWIRGES",
      "id": 103
    },
    {
      "valor": 2.19,
      "produto": "Limão Taiti",
      "loja": "SANTA EDWIRGES",
      "id": 104
    },
    {
      "valor": 4.69,
      "produto": "Cebola",
      "loja": "SANTA EDWIRGES",
      "id": 105
    },
    {
      "valor": 1.89,
      "produto": "Macaxeira",
      "loja": "SANTA EDWIRGES",
      "id": 106
    },
    {
      "valor": 4.99,
      "produto": "Pimentão Verde",
      "loja": "SANTA EDWIRGES",
      "id": 107
    },
    {
      "valor": 2.29,
      "produto": "Chuchu",
      "loja": "SANTA EDWIRGES",
      "id": 108
    },
    {
      "valor": 2.19,
      "produto": "Abóbora Leite",
      "loja": "SANTA EDWIRGES",
      "id": 109
    },
    {
      "valor": 2.19,
      "produto": "Laranja Pera",
      "loja": "SUPER DO POVO",
      "id": 110
    },
    {
      "valor": 1.99,
      "produto": "Limão Taiti",
      "loja": "SUPER DO POVO",
      "id": 111
    },
    {
      "valor": 1.49,
      "produto": "Melancia Baby",
      "loja": "SUPER DO POVO",
      "id": 112
    },
    {
      "valor": 3.19,
      "produto": "Abacate",
      "loja": "SUPER DO POVO",
      "id": 113
    },
    {
      "valor": 3.69,
      "produto": "Repolho Verde",
      "loja": "SUPER DO POVO",
      "id": 114
    },
    {
      "valor": 4.49,
      "produto": "Tomate Comum",
      "loja": "SUPER DO POVO",
      "id": 115
    },
    {
      "valor": 16.9,
      "produto": "Alho",
      "loja": "SUPER DO POVO",
      "id": 116
    },
    {
      "valor": 4.39,
      "produto": "Batata Inglesa",
      "loja": "SUPER DO POVO",
      "id": 117
    },
    {
      "valor": 5.99,
      "produto": "Pimentão Verde",
      "loja": "SUPER DO POVO",
      "id": 118
    },
    {
      "valor": 13.99,
      "produto": "Ovo Extra Branco c/20",
      "loja": "SUPER DO POVO",
      "id": 119
    },
    {
      "valor": 4.29,
      "produto": "Batata Inglesa",
      "loja": "SUPER GENTILÂNDIA",
      "id": 120
    },
    {
      "valor": 4.79,
      "produto": "Cebola",
      "loja": "SUPER GENTILÂNDIA",
      "id": 121
    },
    {
      "valor": 3.49,
      "produto": "Goiaba",
      "loja": "SUPER GENTILÂNDIA",
      "id": 122
    },
    {
      "valor": 2.29,
      "produto": "Chuchu",
      "loja": "SUPER GENTILÂNDIA",
      "id": 123
    },
    {
      "valor": 3.29,
      "produto": "Batata Doce",
      "loja": "SUPER GENTILÂNDIA",
      "id": 124
    },
    {
      "valor": 1.69,
      "produto": "Melancia",
      "loja": "SUPER GENTILÂNDIA",
      "id": 125
    },
    {
      "valor": 2.89,
      "produto": "Melão Japonês",
      "loja": "SUPER GENTILÂNDIA",
      "id": 126
    },
    {
      "valor": 2.39,
      "produto": "Laranja Pera",
      "loja": "SUPER GENTILÂNDIA",
      "id": 127
    },
    {
      "valor": 3.39,
      "produto": "Abacate",
      "loja": "SUPER GENTILÂNDIA",
      "id": 128
    },
    {
      "valor": 2.99,
      "produto": "Acerola 500g",
      "loja": "SUPER GENTILÂNDIA",
      "id": 129
    },
    {
      "valor": 3.49,
      "produto": "Cajá 500g",
      "loja": "SUPER GENTILÂNDIA",
      "id": 130
    },
    {
      "valor": 9.99,
      "produto": "Uva Itália 1kg",
      "loja": "SUPER GENTILÂNDIA",
      "id": 131
    },
    {
      "valor": 14.9,
      "produto": "Alho",
      "loja": "SUPER LAGOA",
      "id": 132
    },
    {
      "valor": 3.99,
      "produto": "Batata Inglesa",
      "loja": "SUPER LAGOA",
      "id": 133
    },
    {
      "valor": 3.99,
      "produto": "Banana Prata",
      "loja": "SUPER LAGOA",
      "id": 134
    },
    {
      "valor": 4.29,
      "produto": "Cebola",
      "loja": "SUPER LAGOA",
      "id": 135
    },
    {
      "valor": 4.49,
      "produto": "Tomate Comum",
      "loja": "SUPER LAGOA",
      "id": 136
    },
    {
      "valor": 1.89,
      "produto": "Limão Taiti",
      "loja": "SUPER LAGOA",
      "id": 137
    },
    {
      "valor": 1.89,
      "produto": "Macaxeira",
      "loja": "SUPER LAGOA",
      "id": 138
    },
    {
      "valor": 1.99,
      "produto": "Laranja Pera",
      "loja": "SUPER LAGOA",
      "id": 139
    },
    {
      "valor": 2.49,
      "produto": "Melão Espanhol",
      "loja": "SUPER LAGOA",
      "id": 140
    },
    {
      "valor": 2.49,
      "produto": "Melão Japonês",
      "loja": "SUPER LAGOA",
      "id": 141
    },
    {
      "valor": 2.49,
      "produto": "Melão Gália",
      "loja": "SUPER LAGOA",
      "id": 142
    },
    {
      "valor": 3.29,
      "produto": "Abacate",
      "loja": "SUPER LAGOA",
      "id": 143
    },
    {
      "valor": 3.29,
      "produto": "Batata Doce",
      "loja": "SUPER LAGOA",
      "id": 144
    },
    {
      "valor": 3.49,
      "produto": "Mamão Formosa",
      "loja": "SUPER LAGOA",
      "id": 145
    },
    {
      "valor": 3.49,
      "produto": "Manga Tommy",
      "loja": "SUPER LAGOA",
      "id": 146
    },
    {
      "valor": 3.99,
      "produto": "Acerola 500g",
      "loja": "SUPER LAGOA",
      "id": 147
    },
    {
      "valor": 3.99,
      "produto": "Batata Doce",
      "loja": "SUPER LAGOA",
      "id": 148
    },
    {
      "valor": 7.99,
      "produto": "Uva Vitótia 500g",
      "loja": "SUPER LAGOA",
      "id": 149
    },
    {
      "valor": 7.99,
      "produto": "Maracujá",
      "loja": "SUPER LAGOA",
      "id": 150
    },
    {
      "valor": 4.99,
      "produto": "Repolho Verde",
      "loja": "SUPER LAGOA",
      "id": 151
    },
    {
      "valor": 14.99,
      "produto": "Ovo Extra Branco c/20",
      "loja": "SUPER LAGOA",
      "id": 152
    },
    {
      "valor": 2.29,
      "produto": "Mamão Formosa",
      "loja": "SUPER PORTUGAL",
      "id": 153
    },
    {
      "valor": 4.19,
      "produto": "Batata Inglesa",
      "loja": "SUPER PORTUGAL",
      "id": 154
    },
    {
      "valor": 3.49,
      "produto": "Goiaba",
      "loja": "SUPER PORTUGAL",
      "id": 155
    },
    {
      "valor": 2.99,
      "produto": "Melão Japonês",
      "loja": "SUPER PORTUGAL",
      "id": 156
    },
    {
      "valor": 2.29,
      "produto": "Laranja Pera",
      "loja": "SUPER PORTUGAL",
      "id": 157
    },
    {
      "valor": 1.69,
      "produto": "Melancia",
      "loja": "SUPER PORTUGAL",
      "id": 158
    },
    {
      "valor": 2.99,
      "produto": "Beterraba",
      "loja": "SUPER PORTUGAL",
      "id": 159
    },
    {
      "valor": 4.79,
      "produto": "Cebola",
      "loja": "SUPER PORTUGAL",
      "id": 160
    },
    {
      "valor": 2.99,
      "produto": "Batata Doce",
      "loja": "SUPER PORTUGAL",
      "id": 161
    },
    {
      "valor": 6.69,
      "produto": "Cenoura",
      "loja": "SUPER PORTUGAL",
      "id": 162
    },
    {
      "valor": 2.99,
      "produto": "Acerola 500g",
      "loja": "SUPER PORTUGAL",
      "id": 163
    },
    {
      "valor": 2.79,
      "produto": "Mamão Formosa",
      "loja": "UNI REDE",
      "id": 164
    },
    {
      "valor": 3.29,
      "produto": "Goiaba",
      "loja": "UNI REDE",
      "id": 165
    },
    {
      "valor": 4.69,
      "produto": "Batata Inglesa",
      "loja": "UNI REDE",
      "id": 166
    },
    {
      "valor": 4.79,
      "produto": "Cebola",
      "loja": "UNI REDE",
      "id": 167
    },
    {
      "valor": 19.9,
      "produto": "Alho",
      "loja": "UNI REDE",
      "id": 168
    },
    {
      "valor": 2.39,
      "produto": "Laranja Pera",
      "loja": "UNI REDE",
      "id": 169
    },
    {
      "valor": 2.99,
      "produto": "Batata Doce",
      "loja": "UNI REDE",
      "id": 170
    },
    {
      "valor": 3.39,
      "produto": "Abacate",
      "loja": "UNI REDE",
      "id": 171
    },
    {
      "valor": 5.49,
      "produto": "Pimentão Verde",
      "loja": "UNI REDE",
      "id": 172
    },
    {
      "valor": 5.89,
      "produto": "Tomate Comum",
      "loja": "UNI REDE",
      "id": 173
    }
  ]
}

const getFinalMarketList = (initialMarketList) => {
  // remove a prop id que não utilizamos
  const handledList = initialMarketList.map((item) => {
    delete item.id;
    return item;
  });

  // agrupa a lista por produto - retorna um objeto
  const groupedObjectByProduct = groupByProduct(handledList);

  // classifica a lista por preço dentro de cada grupo de produto - retorna um array
  const groupedRankedList = Object.entries(groupedObjectByProduct).map(
    ([key, value]) => rankAscendingList(value)
  );

  // desagrupa a lista após a classificação
  const rankedList = groupedRankedList.flat(1);

  // remove os itens com classificação acima de 3º lugar
  const cleanedRankedList = rankedList.filter((item) => item.rank < 4);

  // agrupa os itens por loja
  const groupedObjectByShop = groupByShop(cleanedRankedList);

  // gera a lista final para exibição na tela
  const finalMarketList = generateFinalListHTML(groupedObjectByShop);

  return finalMarketList;
};

const generateFinalListHTML = (obj) => {
  let strFinalList = "";
  Object.entries(sortAscendingObjectByKey(obj)).map(([key, value]) => {
    strFinalList = strFinalList.concat(
      `
      <div id="card">
        <table class="table">
          <thead>
            <tr class="table-header-row">
              <td class="table-header-data">${key.toUpperCase()}</td>
            </tr>
          </thead>
          <tbody>
      `
    );

    sortAscendingListByProduct(value).forEach((item) => {
      strFinalList = strFinalList.concat(
        `
        <tr class="table-row rank-${item.rank}">
          <td class="table-data rank-${item.rank}">${item.rank}º</td>
          <td class="table-data produto">${item.produto}</td>
          <td class="table-data tag-${item.rank}">
            ${
              item.rank === 1
                ? '<span class="material-icons">emoji_events</span>'
                : ""
            }
          </td>
          <td class="table-data valor">${item.valor.toLocaleString("pt-br", {
            style: "decimal",
            minimumFractionDigits: 2,
          })}</td>
        </tr>
        `
      );
    });

    strFinalList = strFinalList.concat(
      `
          </tbody>
        </table>
      </div>
      `
    );
  });

  return strFinalList;
};

const groupByShop = (arr) => {
  return arr.reduce((result, currentValue) => {
    (result[currentValue.loja] = result[currentValue.loja] || []).push(
      currentValue
    );
    return result;
  }, {});
};

const groupByProduct = (arr) => {
  return arr.reduce((result, currentValue) => {
    (result[currentValue.produto] = result[currentValue.produto] || []).push(
      currentValue
    );
    return result;
  }, {});
};

const sortAscendingListByPrice = (arr) =>
  arr.sort((itemA, itemB) => itemA.valor - itemB.valor);

const sortAscendingListByProduct = (arr) =>
  arr.sort((itemA, itemB) => {
    const productA = itemA.produto.toUpperCase();
    const productB = itemB.produto.toUpperCase();
    if (productA < productB) {
      return -1;
    }
    if (productA > productB) {
      return 1;
    }

    return 0;
  });

const sortAscendingObjectByKey = (obj) =>
  Object.entries(obj)
    .sort()
    .reduce((o, [k, v]) => ((o[k] = v), o), {});

const rankAscendingList = (arr) => {
  let rank = 1;
  return sortAscendingListByPrice(arr).map((item, index) => {
    if (index > 0 && item.valor > arr[index - 1].valor) {
      rank++;
    }
    item.rank = rank;
    return item;
  });
};

const checkbox = document.getElementById("checkbox");

const changeTheme = () => {
  document.body.classList.toggle("dark");
};

const loadTheme = () => {
  const isDarkMode = localStorage.getItem("dark");

  if (isDarkMode) {
    changeTheme();
  }
};

loadTheme();

checkbox.addEventListener("change", () => {
  changeTheme();

  //salva ou remove o dark mode]
  localStorage.removeItem("dark");

  if (document.body.classList.contains("dark")) {
    localStorage.setItem("dark", 1);
  }
});

$("#data").html(database.data);

// utilizando api
// let url =
//   "https://api.sheety.co/d3a0bd0987cadf495617032c2aa34290/marketList/list";
// fetch(url)
//   .then((response) => response.json())
//   .then((response) => {
//     $("#json").html(getFinalMarketList(response.list));
//   });

// utilizando arquivo local db.json
$("#lista").html(getFinalMarketList(database.lista));
